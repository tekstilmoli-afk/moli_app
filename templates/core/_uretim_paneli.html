<hr>
<h3>ğŸ“œ Ãœretim GeÃ§miÅŸi</h3>

{% if events %}
    <ul id="gecmis-listesi" class="list-unstyled">
        {% for e in events %}
            <li class="gecmis-item py-1 border-bottom">
                <strong>{{ e.stage|title }}</strong> â†’ {{ e.value|title }}
                â€” <em>{{ e.timestamp|date:"d.m.Y H:i" }}</em>
                â€” {{ e.user }}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>HenÃ¼z geÃ§miÅŸ kaydÄ± yok.</p>
{% endif %}

<hr>
<h4>ğŸ§± AÅŸama ButonlarÄ±</h4>

<div class="stage-buttons">
    <!-- KESÄ°M -->
    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="kesim_durum">
        <input type="hidden" name="value" value="basladi">
        <button class="btn btn-sm btn-primary">âœ‚ï¸ Kesim BaÅŸladÄ±</button>
    </form>

    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="kesim_durum">
        <input type="hidden" name="value" value="bitti">
        <button class="btn btn-sm btn-success">âœ‚ï¸ Kesim Bitti</button>
    </form>

    <!-- DÄ°KÄ°M -->
    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="dikim_durum">
        <input type="hidden" name="value" value="basladi">
        <button class="btn btn-sm btn-primary">ğŸ§µ Dikim BaÅŸladÄ±</button>
    </form>

    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="dikim_durum">
        <input type="hidden" name="value" value="bitti">
        <button class="btn btn-sm btn-success">ğŸ§µ Dikim Bitti</button>
    </form>

    <!-- NAKIÅ -->
    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="nakis_durumu">
        <input type="hidden" name="value" value="verildi">
        <button class="btn btn-sm btn-warning">ğŸª¡ NakÄ±ÅŸ Verildi</button>
    </form>

    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="nakis_durumu">
        <input type="hidden" name="value" value="alindi">
        <button class="btn btn-sm btn-info">ğŸª¡ NakÄ±ÅŸ AlÄ±ndÄ±</button>
    </form>

    <!-- SÃœSLEME -->
    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="susleme_durum">
        <input type="hidden" name="value" value="basladi">
        <button class="btn btn-sm btn-primary">âœ¨ SÃ¼sleme BaÅŸladÄ±</button>
    </form>

    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="susleme_durum">
        <input type="hidden" name="value" value="bitti">
        <button class="btn btn-sm btn-success">âœ¨ SÃ¼sleme Bitti</button>
    </form>

    <!-- HAZIR -->
    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="hazir_durum">
        <input type="hidden" name="value" value="bitti">
        <button class="btn btn-sm btn-success">ğŸ“¦ HazÄ±rlandÄ±</button>
    </form>

    <!-- SEVKÄ°YAT -->
    <form hx-get="{% url 'update_stage' order.id %}" 
          hx-target="#uretim-paneli" 
          hx-swap="innerHTML transition:true">
        <input type="hidden" name="stage" value="sevkiyat_durum">
        <input type="hidden" name="value" value="gonderildi">
        <button class="btn btn-sm btn-dark">ğŸšš GÃ¶nderildi</button>
    </form>
</div>

<!-- âœ¨ Yeni geÃ§miÅŸ satÄ±rÄ± eklendiÄŸinde aÅŸaÄŸÄ± kaydÄ±rma efekti -->
<script>
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        if (evt.target.id === 'uretim-paneli') {
            const list = document.getElementById('gecmis-listesi');
            if (list) {
                list.lastElementChild?.scrollIntoView({ behavior: 'smooth' });
            }
        }
    });
</script>
