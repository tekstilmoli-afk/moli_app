{# ==== _uretim_paneli.html â€” PART 1/3: Styles + History ==== #}
<style>
    /* ğŸ“œ ÃœRETÄ°M GEÃ‡MÄ°ÅÄ° */
    .gecmis-item { font-size: 14px; }
    .gecmis-item strong { color: #0d6efd; }

    /* ğŸ¨ Soft UI Buton TasarÄ±mÄ± */
    .soft-btn {
        padding: 10px 16px;
        border-radius: 10px;
        border: none;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin: 5px;
    }
    .soft-btn:active { transform: scale(0.97); }

    .btn-soft-primary { background: #d9e8ff; color: #004085; }
    .btn-soft-warning { background: #fff3cd; color: #856404; }
    .btn-soft-success { background: #d4edda; color: #155724; }
    .btn-soft-info    { background: #d1ecf1; color: #0c5460; }
    .btn-soft-dark    { background: #ced4da; color: #343a40; }
    .btn-soft-secondary { background: #e2e3e5; color: #383d41; }

    /* ğŸ“¦ AÅŸama bloklarÄ± */
    .stage-buttons { display: flex; flex-direction: column; gap: 20px; margin-top: 20px; }
    .stage-block h6 { margin-bottom: 10px; font-weight: bold; }
    .stage-actions { display: flex; flex-wrap: wrap; gap: 10px; }
</style>

<!-- ğŸ“œ ÃœRETÄ°M GEÃ‡MÄ°ÅÄ° ALANI -->
<hr>
<h3>ğŸ“œ Ãœretim GeÃ§miÅŸi</h3>

{% if events %}
    <ul id="gecmis-listesi" class="list-unstyled">
        {% for e in events %}
            <li class="gecmis-item py-1 border-bottom">
                <strong>
                    {% if e.stage == 'dikim_durum' and e.value == 'sÄ±raya_alÄ±ndÄ±' %}
                        Dikime AlÄ±ndÄ±
                    {% elif e.stage == 'susleme_durum' and e.value == 'sÄ±raya_alÄ±ndÄ±' %}
                        SÃ¼sleme SÄ±rasÄ±na AlÄ±ndÄ±
                    {% elif e.stage == 'dikim_durum' and e.value == 'basladi' %}
                        Dikime BaÅŸlandÄ±
                    {% elif e.stage == 'dikim_durum' and e.value == 'kismi_bitti' %}
                        KÄ±smi Dikim YapÄ±ldÄ±
                    {% elif e.stage == 'dikim_durum' and e.value == 'bitti' %}
                        Dikim Bitti
                    {% elif e.stage == 'kesim_durum' and e.value == 'basladi' %}
                        Kesime BaÅŸlandÄ±
                    {% elif e.stage == 'kesim_durum' and e.value == 'kismi_bitti' %}
                        KÄ±smi Kesim YapÄ±ldÄ±
                    {% elif e.stage == 'kesim_durum' and e.value == 'bitti' %}
                        Kesim Bitti
                    {% elif e.stage == 'susleme_durum' and e.value == 'basladi' %}
                        SÃ¼sleme BaÅŸladÄ±
                    {% elif e.stage == 'susleme_durum' and e.value == 'kismi_bitti' %}
                        KÄ±smi SÃ¼sleme YapÄ±ldÄ±
                    {% elif e.stage == 'susleme_durum' and e.value == 'bitti' %}
                        SÃ¼sleme Bitti
                    {% elif e.stage == 'dikim_fason_durumu' and e.value == 'verildi' %}
                        Dikim Ä°Ã§in Fasona Verildi
                    {% elif e.stage == 'dikim_fason_durumu' and e.value == 'alindi' %}
                        Dikim Fasoncusundan AlÄ±ndÄ±
                    {% elif e.stage == 'susleme_fason_durumu' and e.value == 'verildi' %}
                        SÃ¼sleme Ä°Ã§in Fasona Verildi
                    {% elif e.stage == 'susleme_fason_durumu' and e.value == 'alindi' %}
                        SÃ¼sleme Fasoncusundan AlÄ±ndÄ±
                    {% elif e.stage == 'sevkiyat_durum' and e.value == 'gonderildi' %}
                        Sevkiyat GÃ¶nderildi
                    {% else %}
                        {{ e.stage|title }} â†’ {{ e.value|title }}
                    {% endif %}
                </strong>
                â€” <em>{{ e.timestamp|date:"d.m.Y H:i" }}</em>
                â€” ğŸ‘¤ {{ e.user }}
                {% if e.parca %} | ğŸ§© <span class="text-muted">{{ e.parca }}</span>{% endif %}
                {% if e.adet %} | ğŸ”¢ {{ e.adet }} adet{% endif %}
                {% if e.aciklama %} | ğŸ’¬ {{ e.aciklama }}{% endif %}
                {% if e.ortak_calisanlar %} | ğŸ‘¥ {{ e.ortak_calisanlar }}{% endif %}
                {% if e.fasoncu %} | ğŸ­ FASONCU: {{ e.fasoncu.ad|upper }}{% endif %}
                {% if e.nakisci %} | ğŸª¡ NAKIÅÃ‡I: {{ e.nakisci.ad|upper }}{% endif %}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>HenÃ¼z geÃ§miÅŸ kaydÄ± yok.</p>
{% endif %}

<hr>
<h4 class="mt-4">ğŸ§± AÅŸama ButonlarÄ±</h4>

<div class="stage-buttons">
    {# Part 2 burada baÅŸlayacak #}

{# ==== _uretim_paneli.html â€” PART 2/3: Kesim + Dikim + Fason Dikim + NakÄ±ÅŸ ==== #}

<!-- âœ‚ï¸ KESÄ°M BLOKU -->
<div class="stage-block">
    <h6 class="text-primary">âœ‚ï¸ Kesim</h6>
    <div class="stage-actions">
        <button class="soft-btn btn-soft-primary"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "kesim_durum", "value": "basladi"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">Kesim BaÅŸladÄ±</button>

        <button class="soft-btn btn-soft-warning"
            onclick="return kismiIslem(this, 'kesim_durum', 'kismi_bitti');">KÄ±smi Kesim</button>

        <button class="soft-btn btn-soft-success"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "kesim_durum", "value": "bitti"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">Kesim Bitti</button>
    </div>
</div>

<!-- ğŸ§µ DÄ°KÄ°M BLOKU -->
<div class="stage-block">
    <h6 class="text-primary">ğŸ§µ Dikim</h6>
    <div class="stage-actions">
        <button class="soft-btn btn-soft-secondary"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "dikim_durum", "value": "sÄ±raya_alÄ±ndÄ±"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">Dikim SÄ±rasÄ±na AlÄ±ndÄ±</button>

        <button class="soft-btn btn-soft-primary"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "dikim_durum", "value": "basladi"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">Dikim BaÅŸladÄ±</button>

        <button class="soft-btn btn-soft-warning"
            onclick="return kismiIslem(this, 'dikim_durum', 'kismi_bitti');">KÄ±smi Dikim</button>

        <button class="soft-btn btn-soft-success"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "dikim_durum", "value": "bitti"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">Dikim Bitti</button>
    </div>
</div>

<!-- ğŸ­ FASON DÄ°KÄ°M BLOKU -->
<div class="stage-block">
    <h6 class="text-primary">ğŸ­ Fason Dikim</h6>
    <div class="stage-actions">

        <!-- ğŸ“¤ FASON VERÄ°LDÄ° -->
        <div class="dropdown">
            <button class="soft-btn btn-soft-warning dropdown-toggle" type="button" data-bs-toggle="dropdown">
                ğŸ“¤ Fason Verildi
            </button>
            <ul class="dropdown-menu">
                {% for f in fasoncular %}
                <li>
                    <a class="dropdown-item" href="#"
                       onclick="return fasonIslem('{{ f.id }}', 'dikim_fason_durumu', 'verildi');">
                        {{ f.ad }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- ğŸ“¥ FASON ALINDI -->
        <div class="dropdown">
            <button class="soft-btn btn-soft-info dropdown-toggle" type="button" data-bs-toggle="dropdown">
                ğŸ“¥ Fason AlÄ±ndÄ±
            </button>
            <ul class="dropdown-menu">
                {% for f in fasoncular %}
                <li>
                    <a class="dropdown-item" href="#"
                       onclick="return fasonIslem('{{ f.id }}', 'dikim_fason_durumu', 'alindi');">
                        {{ f.ad }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<!-- ğŸª¡ NAKIÅ BLOKU -->
<div class="stage-block">
    <h6 class="text-primary">ğŸª¡ NakÄ±ÅŸ</h6>
    <div class="stage-actions">

        <!-- ğŸ“¤ NAKIÅ VERÄ°LDÄ° -->
        <div class="dropdown">
            <button class="soft-btn btn-soft-warning dropdown-toggle" type="button" data-bs-toggle="dropdown">
                ğŸ“¤ NakÄ±ÅŸ Verildi
            </button>
            <ul class="dropdown-menu">
                {% for n in nakisciler %}
                <li>
                    <a class="dropdown-item" href="#"
                       onclick="return fasonIslem('{{ n.id }}', 'nakis_durumu', 'verildi');">
                        {{ n.ad }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- ğŸ“¥ NAKIÅ ALINDI -->
        <div class="dropdown">
            <button class="soft-btn btn-soft-info dropdown-toggle" type="button" data-bs-toggle="dropdown">
                ğŸ“¥ NakÄ±ÅŸ AlÄ±ndÄ±
            </button>
            <ul class="dropdown-menu">
                {% for n in nakisciler %}
                <li>
                    <a class="dropdown-item" href="#"
                       onclick="return fasonIslem('{{ n.id }}', 'nakis_durumu', 'alindi');">
                        {{ n.ad }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

{# ==== _uretim_paneli.html â€” PART 3/3: SÃ¼sleme + Fason SÃ¼sleme + HazÄ±r/Sevkiyat + Script ==== #}

<!-- âœ¨ SÃœSLEME BLOKU -->
<div class="stage-block">
    <h6 class="text-primary">âœ¨ SÃ¼sleme</h6>
    <div class="stage-actions">
        <button class="soft-btn btn-soft-secondary"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "susleme_durum", "value": "sÄ±raya_alÄ±ndÄ±"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">SÃ¼sleme SÄ±rasÄ±na AlÄ±ndÄ±</button>

        <button class="soft-btn btn-soft-primary"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "susleme_durum", "value": "basladi"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">SÃ¼sleme BaÅŸladÄ±</button>

        <button class="soft-btn btn-soft-warning"
            onclick="return kismiIslem(this, 'susleme_durum', 'kismi_bitti');">KÄ±smi SÃ¼sleme</button>

        <button class="soft-btn btn-soft-success"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "susleme_durum", "value": "bitti"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">SÃ¼sleme Bitti</button>
    </div>
</div>

<!-- ğŸ­ FASON SÃœSLEME BLOKU -->
<div class="stage-block">
    <h6 class="text-primary">ğŸ­ Fason SÃ¼sleme</h6>
    <div class="stage-actions">

        <!-- ğŸ“¤ FASON VERÄ°LDÄ° -->
        <div class="dropdown">
            <button class="soft-btn btn-soft-warning dropdown-toggle" type="button" data-bs-toggle="dropdown">
                ğŸ“¤ Fason Verildi
            </button>
            <ul class="dropdown-menu">
                {% for f in fasoncular %}
                <li>
                    <a class="dropdown-item" href="#"
                       onclick="return fasonIslem('{{ f.id }}', 'susleme_fason_durumu', 'verildi');">
                        {{ f.ad }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- ğŸ“¥ FASON ALINDI -->
        <div class="dropdown">
            <button class="soft-btn btn-soft-info dropdown-toggle" type="button" data-bs-toggle="dropdown">
                ğŸ“¥ Fason AlÄ±ndÄ±
            </button>
            <ul class="dropdown-menu">
                {% for f in fasoncular %}
                <li>
                    <a class="dropdown-item" href="#"
                       onclick="return fasonIslem('{{ f.id }}', 'susleme_fason_durumu', 'alindi');">
                        {{ f.ad }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<!-- âœ… HAZIR + SEVKÄ°YAT BLOÄU -->
<div class="stage-block">
    <h6 class="text-primary">ğŸ“¦ HazÄ±r & ğŸšš Sevkiyat</h6>
    <div class="stage-actions">
        <button class="soft-btn btn-soft-success"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "hazir_durum", "value": "bitti"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">ğŸ“¦ HazÄ±rlandÄ±</button>

        <button class="soft-btn btn-soft-dark"
            hx-get="{% url 'update_stage' order.id %}"
            hx-vals='{"stage": "sevkiyat_durum", "value": "gonderildi"}'
            hx-target="#uretim-paneli" hx-swap="innerHTML">ğŸšš GÃ¶nderildi</button>
    </div>
</div>

<!-- âœ… JS FonksiyonlarÄ± -->
<script>
function kismiIslem(button, stage, value) {
    const text = prompt("KÄ±smi iÅŸlemi belirtiniz (Ã¶r: Kol, Etek, Yaka)");
    if (!text) return false;
    htmx.ajax('GET', `{% url 'update_stage' order.id %}`, {
        target: '#uretim-paneli',
        swap: 'innerHTML',
        values: { stage: stage, value: value, aciklama: text }
    });
    return false;
}

function fasonIslem(fasoncuId, stage, value) {
    if (!fasoncuId) return false;
    htmx.ajax('GET', `{% url 'update_stage' order.id %}`, {
        target: '#uretim-paneli',
        swap: 'innerHTML',
        values: { stage: stage, value: value, fasoncu: fasoncuId }
    });
    return false;
}

document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.target.id === 'uretim-paneli') {
        const list = document.getElementById('gecmis-listesi');
        if (list) {
            list.lastElementChild?.scrollIntoView({ behavior: 'smooth' });
        }
    }
});
</script>
