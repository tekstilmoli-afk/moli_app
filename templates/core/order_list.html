<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>SipariÅŸ Listesi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        th a { color: white; text-decoration: none; }
        th a:hover { text-decoration: underline; }
        .filter-dropdown { max-height: 240px; overflow-y: auto; min-width: 180px; }
        .print-btn { padding: 2px 6px; font-size: 0.8rem; }
        .qr-img { width: 50px; height: 50px; object-fit: contain; }
        .stage-info { font-size: 0.7rem; line-height: 1.1; }
        .aciklama-cell { font-size: 0.75rem; max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .table-responsive { overflow-x: auto; }
        thead th .dropdown-toggle { color: #fff; padding: 0; font-size: 0.85rem; }
        thead th .dropdown-toggle::after { margin-left: .35rem; }
        th, td { vertical-align: middle; white-space: nowrap; }
    </style>
</head>
<body class="bg-light py-4">

<div class="container-fluid">
    <h2 class="mb-4 text-center">ðŸ“‹ SipariÅŸ Listesi</h2>

    <!-- Ãœst bar -->
    <form method="get" class="mb-3" id="searchForm">
        <div class="row g-2 align-items-stretch">
            <div class="col-12 col-md-2 d-grid">
                <a href="{% url 'order_create' %}" class="btn btn-primary">âž• Yeni SipariÅŸ</a>
            </div>
            <div class="col-12 col-md-2 d-grid">
                <a href="{% url 'musteri_create' %}" class="btn btn-outline-primary">ðŸ‘¤ MÃ¼ÅŸteri Ekle</a>
            </div>
            <div class="col-12 col-md-4">
                <input type="text" name="q" value="{{ q }}" placeholder="Ara..." class="form-control">
            </div>
            <div class="col-12 col-md-2 d-grid">
                <button type="submit" class="btn btn-secondary">Ara</button>
            </div>
            <div class="col-12 col-md-2 d-grid">
                <a href="{% url 'export_orders_excel' %}?{{ request.GET.urlencode }}" class="btn btn-success">ðŸ“¥ Excel Ä°ndir</a>
            </div>
        </div>
    </form>

    <!-- Tablo -->
    <div id="order-table-container">
        {% include "core/order_table_partial.html" %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
function printLabel(siparisNo, musteri, urunKodu, adet, qrUrl) {
    const printWindow = window.open('', '', 'width=350,height=400');
    printWindow.document.write(`
        <html>
        <head>
            <title>Etiket YazdÄ±r</title>
            <style>
                body { font-family: Arial, sans-serif; text-align: center; padding: 10px; }
                .label-box { border: 1px solid #000; padding: 10px; margin: 10px auto; width: 280px; }
                .label-box img { max-width: 120px; margin-top: 10px; }
                .info { font-size: 14px; text-align: left; margin-top: 5px; }
                .info strong { display: inline-block; width: 100px; }
            </style>
        </head>
        <body>
            <div class="label-box">
                <h3>SipariÅŸ Etiketi</h3>
                <div class="info"><strong>No:</strong> ${siparisNo || ''}</div>
                <div class="info"><strong>MÃ¼ÅŸteri:</strong> ${musteri || ''}</div>
                <div class="info"><strong>ÃœrÃ¼n:</strong> ${urunKodu || ''}</div>
                <div class="info"><strong>Adet:</strong> ${adet || ''}</div>
                ${qrUrl ? `<img src="${qrUrl}" alt="QR Kod">` : ''}
            </div>
            <script>window.onload = function(){ window.print(); setTimeout(()=>window.close(), 500); }<\/script>
        </body>
        </html>
    `);
    printWindow.document.close();
}
</script>

</body>
</html>