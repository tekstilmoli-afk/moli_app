{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ã‡oklu SipariÅŸ OluÅŸtur</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<style>
    body { background: #f7f7f7; }
    .card { border-radius: 12px; }
    /* --- Select2 Tekli SeÃ§im AlanÄ± Hizalama --- */
.select2-container .select2-selection--single {
    height: 42px !important;
    border: 1px solid #ced4da !important;
    border-radius: 6px !important;
    display: flex !important;
    align-items: center !important;
    padding-left: 12px !important;
    box-sizing: border-box !important;
}

/* Ä°Ã§ metni ortala */
.select2-selection__rendered {
    line-height: 40px !important;
}

/* Ok ikonu hizalama */
.select2-selection__arrow {
    height: 40px !important;
    margin-top: 1px !important;
}

/* Ayar butonunu Select2 ile aynÄ± hizaya getir */
.input-group .btn-settings {
    height: 42px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 12px !important;
}

.select2-container {
    width: 100% !important;
}


/* Select2 dÄ±ÅŸ container yÃ¼ksekliÄŸini sabitle */
.select2-container {
    height: 42px !important;
    padding: 0 !important;
}

/* Ä°Ã§ select alanÄ±nÄ± dikey ortala */
.select2-container .select2-selection--single {
    height: 42px !important;
    line-height: 42px !important;
}


</style>
</head>

<body class="py-4">

<div class="container">
    <div class="d-flex justify-content-between mb-3">
        <h3>â• Ã‡oklu SipariÅŸ OluÅŸtur</h3>
        <a href="{% url 'order_list' %}" class="btn btn-secondary">â¬… Geri</a>
    </div>

    <div class="card shadow p-4">
        <form method="POST">
            {% csrf_token %}

            <div class="row mb-3">

    <!-- SipariÅŸ Tipi -->
    <div class="col-md-4">
        <label class="form-label fw-bold">SipariÅŸ Tipi</label>
        <select id="siparis_tipi_select" name="siparis_tipi" class="form-select" required>
            <option value="SERI">Seri</option>
            <option value="STOK">StoÄŸa Ãœretim</option>
            <option value="OZEL">Ã–zel SipariÅŸ</option>
        </select>
    </div>

    <!-- MÃ¼ÅŸteri -->
    <div class="col-md-4">
        <label class="form-label fw-bold">MÃ¼ÅŸteri</label>
        <select id="musteri_select" name="musteri" class="form-select select2" required>
            <option value="">SeÃ§iniz</option>
            {% for m in musteriler %}
                <option value="{{ m.id }}">{{ m.ad }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- ÃœrÃ¼n Kodu -->
    <div class="col-md-4">
        <label class="form-label fw-bold">ÃœrÃ¼n Kodu</label>
        <select id="urun_kodu_select" name="urun_kodu" class="form-select select2" required>
            <option value="">SeÃ§iniz</option>
            {% for u in urun_kodlari %}
                <option value="{{ u.kod }}">{{ u.kod }}</option>
            {% endfor %}
        </select>
    </div>

</div>

            <hr>
            <h5 class="fw-bold mb-3 d-flex justify-content-between align-items-center">
    <span>Renk - Beden SatÄ±rlarÄ±</span>

    <span class="d-flex gap-2">

        <!-- Renk YÃ¶net -->
        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#renkModal">
            ğŸ¨ Renk YÃ¶net
        </button>

        <!-- Beden YÃ¶net -->
        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#bedenModal">
            ğŸ‘• Beden YÃ¶net
        </button>

        <!-- MÃ¼ÅŸteri YÃ¶net -->
        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#musteriModal">
            ğŸ§ MÃ¼ÅŸteri YÃ¶net
        </button>

        <!-- ÃœrÃ¼n Kodu YÃ¶net -->
        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#urunKodModal">
            ğŸ“¦ ÃœrÃ¼n Kodu YÃ¶net
        </button>

    </span>
</h5>


            <!-- ğŸ”» SATIRLAR -->
            <div id="rows-container">

                <div class="row mb-3 renk-beden-row" data-index="0">

    <div class="col-md-3">
        <label class="form-label">Renk</label>
        <select name="renk_row_0" class="form-select select2 renk-select">
            {% for r in renkler %}
            <option value="{{ r.ad }}">{{ r.ad }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-4">
        <label class="form-label">Bedenler</label>
        <select name="beden_row_0[]" class="form-select select2 beden-select" multiple>
            {% for b in bedenler %}
            <option value="{{ b.ad }}">{{ b.ad }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <label class="form-label">Adet</label>
        <input type="number" min="1" value="1" name="adet_row_0" class="form-control">
    </div>

    <div class="col-md-3">
        <label class="form-label">MÃ¼ÅŸteri ReferansÄ±</label>
        <input type="text" name="musteri_ref_row_0" class="form-control" placeholder="Ã–rn: PO123">
    </div>


                    <div class="col-12 mt-2">
    <button type="button" class="btn btn-danger remove-row">Sil</button>
</div>
                </div>

            </div>

            <button type="button" id="add-row" class="btn btn-success">+ SatÄ±r Ekle</button>

            <hr class="mt-4">

            <!-- ğŸ”¹ GENEL TARÄ°H & AÃ‡IKLAMA (TÃœM SÄ°PARÄ°ÅLER Ä°Ã‡Ä°N ORTAK) -->
            <div class="row mb-4 mt-4">
                <div class="col-md-6">
                    <label class="form-label fw-bold">Teslim Tarihi</label>
                    <input type="date" name="teslim_tarihi" class="form-control">
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-bold">AÃ§Ä±klama</label>
                    <input type="text" name="aciklama" class="form-control" placeholder="Opsiyonel">
                </div>
            </div>

            <!-- ğŸ’° FÄ°YAT & MALÄ°YET BÃ–LÃœMÃœ (GENEL) -->
            {% if is_manager %}
            <hr class="mt-4 mb-3">
            <h5 class="text-primary">ğŸ’° Fiyat & Maliyet Bilgileri (TÃ¼m OluÅŸturulacak SipariÅŸler Ä°Ã§in)</h5>

            <div class="row g-3 mt-1">
                <div class="col-md-4">
                    <label class="form-label fw-semibold">SatÄ±ÅŸ FiyatÄ±</label>
                    <input type="number" step="0.01" name="satis_fiyati" class="form-control">
                </div>

                <div class="col-md-2">
                    <label class="form-label fw-semibold">Para</label>
                    <input type="text" name="para_birimi" class="form-control" value="TRY">
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Maliyet (Sistemdeki)</label>
                    <input type="number" step="0.01" name="maliyet_uygulanan" class="form-control">
                </div>

                <div class="col-md-2">
                    <label class="form-label fw-semibold">Para</label>
                    <input type="text" name="maliyet_para_birimi" class="form-control" value="TRY">
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Manuel Maliyet</label>
                    <input type="number" step="0.01" name="maliyet_override" class="form-control">
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Ekstra Maliyet</label>
                    <input type="number" step="0.01" name="ekstra_maliyet" class="form-control">
                </div>

                <div class="col-12">
                    <div class="alert alert-info py-2 mt-2">
                        <strong>ğŸ’¹ Not:</strong> Bu alanlar girilirse tÃ¼m oluÅŸturulan sipariÅŸlerde aynÄ± fiyat & maliyet bilgisi kullanÄ±lacaktÄ±r.
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="text-center mt-4">
                <button class="btn btn-primary px-5 py-2">ğŸš€ SipariÅŸleri OluÅŸtur</button>
            </div>

        </form>
    </div>
</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function () {

$(".select2").select2({
    minimumResultsForSearch: 0,
    width: "100%"
});

    let index = 1;

$(document).on('select2:open', () => {
    document.querySelector('.select2-container--open .select2-search__field').focus();
});

    


    // SatÄ±r ekle
    $("#add-row").click(function () {
        let row = `
        <div class="row mb-3 renk-beden-row" data-index="${index}">
            <div class="col-md-3">
                <label class="form-label">Renk</label>
                <select name="renk_row_${index}" class="form-select select2 renk-select">
                    {% for r in renkler %}
                    <option value="{{ r.ad }}">{{ r.ad }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label">Bedenler</label>
                <select name="beden_row_${index}[]" class="form-select select2 beden-select" multiple>
                    {% for b in bedenler %}
                    <option value="{{ b.ad }}">{{ b.ad }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
    <label class="form-label">Adet</label>
    <input type="number" min="1" value="1" name="adet_row_${index}" class="form-control">
</div>


            <div class="col-md-3">
                <label class="form-label">MÃ¼ÅŸteri ReferansÄ±</label>
                <input type="text" name="musteri_ref_row_${index}" class="form-control" placeholder="Ã–rn: PO123">
            </div>

            <div class="col-12 mt-2">
    <button type="button" class="btn btn-danger remove-row">Sil</button>
</div>
        </div>`;

        $("#rows-container").append(row);
        $(".select2").select2({
    minimumResultsForSearch: 0,
    width: "100%"
});
        $(document).on('select2:open', () => {
    document.querySelector('.select2-container--open .select2-search__field').focus();
});

        index++;
    });

    $(document).on("click", ".remove-row", function () {
        $(this).closest(".renk-beden-row").remove();
    });

    // StoÄŸa Ã¼retim ise mÃ¼ÅŸteri zorunlu olmasÄ±n (istersen)
    $("#siparis_tipi_select").on("change", function () {
        const tip = $(this).val();
        const musteriDiv = $("#musteri_select").closest(".col-md-4");

        if (tip === "STOK") {
            $("#musteri_select").val("").trigger("change");
            musteriDiv.hide();
        } else {
            musteriDiv.show();
        }
    }).trigger("change");

});
</script>

<!-- ------------------------------------------------------------- -->
<!-- ğŸ“Œ MÃœÅTERÄ° YÃ–NETÄ°M MODALI (EKLE + PASÄ°F) -->
<!-- ------------------------------------------------------------- -->
<div class="modal fade" id="musteriModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">ğŸ‘¤ MÃ¼ÅŸteri YÃ¶netimi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <h6 class="fw-bold mb-2">â• Yeni MÃ¼ÅŸteri Ekle</h6>
        <input type="text" id="modal_musteri_ad" class="form-control mb-3" placeholder="Ã–rn: Ahmet Tekstil">
        <button class="btn btn-primary w-100 mb-4" onclick="musteriKaydet()">â• Kaydet</button>

        <hr>

        <h6 class="fw-bold mb-2">âš ï¸ MÃ¼ÅŸteri Pasif Yap</h6>
        <select id="modal_musteri_listesi" class="form-select mb-2">
            <option value="">MÃ¼ÅŸteri seÃ§in...</option>
            {% for musteri in aktif_musteriler %}
                <option value="{{ musteri.id }}">{{ musteri.ad }}</option>
            {% endfor %}
        </select>

        <button class="btn btn-warning w-100" onclick="musteriPasifYap()">ğŸš« SeÃ§ili MÃ¼ÅŸteriyi Pasif Yap</button>

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>

    </div>
  </div>
</div>

<!-- ------------------------------------------------------------- -->
<!-- ğŸ“Œ RENK YÃ–NETÄ°M MODALI -->
<!-- ------------------------------------------------------------- -->
<div class="modal fade" id="renkModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">ğŸ¨ Renk YÃ¶netimi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <h6 class="fw-bold mb-2">â• Yeni Renk Ekle</h6>
        <input type="text" id="modal_renk_ad" class="form-control mb-3" placeholder="Ã–rn: Lacivert">
        <button class="btn btn-primary w-100 mb-4" onclick="renkKaydet()">â• Kaydet</button>

        <hr>

        <h6 class="fw-bold mb-2">âš ï¸ Renk Pasif Yap</h6>
        <select id="modal_renk_listesi" class="form-select mb-2">
            <option value="">Renk seÃ§in...</option>
            {% for r in aktif_renkler %}
                <option value="{{ r.id }}">{{ r.ad }}</option>
            {% endfor %}
        </select>

        <button class="btn btn-warning w-100" onclick="renkPasifYap()">ğŸš« SeÃ§ili Rengi Pasif Yap</button>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>

    </div>
  </div>
</div>

<!-- ------------------------------------------------------------- -->
<!-- ğŸ“Œ BEDEN YÃ–NETÄ°M MODALI -->
<!-- ------------------------------------------------------------- -->
<div class="modal fade" id="bedenModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">ğŸ‘• Beden YÃ¶netimi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <h6 class="fw-bold mb-2">â• Yeni Beden Ekle</h6>
        <input type="text" id="modal_beden_ad" class="form-control mb-3" placeholder="Ã–rn: S / M / 1Y">
        <button class="btn btn-primary w-100 mb-4" onclick="bedenKaydet()">â• Kaydet</button>

        <hr>

        <h6 class="fw-bold mb-2">âš ï¸ Beden Pasif Yap</h6>
        <select id="modal_beden_listesi" class="form-select mb-2">
            <option value="">Beden seÃ§in...</option>
            {% for b in aktif_bedenler %}
                <option value="{{ b.id }}">{{ b.ad }}</option>
            {% endfor %}
        </select>

        <button class="btn btn-warning w-100" onclick="bedenPasifYap()">ğŸš« SeÃ§ili Bedeni Pasif Yap</button>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>

    </div>
  </div>
</div>

<!-- ------------------------------------------------------------- -->
<!-- ğŸ“Œ ÃœRÃœN KODU YÃ–NETÄ°M MODALI -->
<!-- ------------------------------------------------------------- -->
<div class="modal fade" id="urunKodModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">ğŸ“¦ ÃœrÃ¼n Kodu YÃ¶netimi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <h6 class="fw-bold mb-2">â• Yeni ÃœrÃ¼n Kodu Ekle</h6>
        <input type="text" id="modal_urun_kod" class="form-control mb-3" placeholder="Ã–rn: 7058 / VS01">
        <button class="btn btn-primary w-100 mb-4" onclick="urunKodKaydet()">â• Kaydet</button>

        <hr>

        <h6 class="fw-bold mb-2">âš ï¸ ÃœrÃ¼n Kodunu Pasif Yap</h6>
        <select id="modal_urun_kod_listesi" class="form-select mb-2">
            <option value="">ÃœrÃ¼n kodu seÃ§in...</option>
            {% for u in aktif_urun_kodlari %}
                <option value="{{ u.id }}">{{ u.kod }}</option>
            {% endfor %}
        </select>

        <button class="btn btn-warning w-100" onclick="urunKodPasifYap()">ğŸš« SeÃ§ili ÃœrÃ¼n Kodunu Pasif Yap</button>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
      </div>

    </div>
  </div>
</div>

<script>
// ğŸ” CSRF iÃ§in yardÄ±mcÄ±
function getCSRFToken() {
    return "{{ csrf_token }}";
}

/* ----------------- MÃœÅTERÄ° ----------------- */
function musteriKaydet() {
    const ad = document.getElementById("modal_musteri_ad").value.trim();
    if (!ad) { alert("MÃ¼ÅŸteri adÄ± boÅŸ olamaz!"); return; }

    fetch("/ajax/musteri/ekle/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "ad": ad })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            const select = document.getElementById("musteri_select");
            const opt = new Option(data.ad, data.id, true, true);
            select.add(opt);
            $("#musteri_select").trigger("change");

            const modalSelect = document.getElementById("modal_musteri_listesi");
            modalSelect.add(new Option(data.ad, data.id));

            document.getElementById("modal_musteri_ad").value = "";
            bootstrap.Modal.getInstance(document.getElementById("musteriModal")).hide();
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}

function musteriPasifYap() {
    const musteriId = document.getElementById("modal_musteri_listesi").value;
    if (!musteriId) { alert("LÃ¼tfen mÃ¼ÅŸteri seÃ§in."); return; }
    if (!confirm("SeÃ§ili mÃ¼ÅŸteriyi pasif yapmak istediÄŸinize emin misiniz?")) return;

    fetch("/ajax/musteri/pasif-yap/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "id": musteriId })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("MÃ¼ÅŸteri pasif yapÄ±ldÄ±.");

            $("#musteri_select option[value='" + musteriId + "']").remove();
            $("#musteri_select").trigger("change");
            $("#modal_musteri_listesi option[value='" + musteriId + "']").remove();
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}

/* ----------------- RENK ----------------- */
function renkKaydet() {
    const ad = document.getElementById("modal_renk_ad").value.trim();
    if (!ad) { alert("Renk adÄ± boÅŸ olamaz!"); return; }

    fetch("/ajax/renk/ekle/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "ad": ad })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            // TÃ¼m renk selectlerine ekle
            document.querySelectorAll(".renk-select").forEach(sel => {
                sel.add(new Option(data.ad, data.ad));
            });

            const modalSelect = document.getElementById("modal_renk_listesi");
            modalSelect.add(new Option(data.ad, data.id));

            document.getElementById("modal_renk_ad").value = "";
            bootstrap.Modal.getInstance(document.getElementById("renkModal")).hide();
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}

function renkPasifYap() {
    const renkId = document.getElementById("modal_renk_listesi").value;
    if (!renkId) { alert("LÃ¼tfen renk seÃ§in."); return; }

    if (!confirm("SeÃ§ili rengi pasif yapmak istediÄŸinize emin misiniz?")) return;

    fetch("/ajax/renk/pasif-yap/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "id": renkId })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Renk pasif yapÄ±ldÄ±.");
            $("#modal_renk_listesi option[value='" + renkId + "']").remove();
            // Ä°stersen renk selectlerinden de silebilirsin, ama value deÄŸil adÄ±na gÃ¶re eÅŸleÅŸmek lazÄ±m.
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}

/* ----------------- BEDEN ----------------- */
function bedenKaydet() {
    const ad = document.getElementById("modal_beden_ad").value.trim();
    if (!ad) { alert("Beden boÅŸ olamaz!"); return; }

    fetch("/ajax/beden/ekle/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "ad": ad })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.querySelectorAll(".beden-select").forEach(sel => {
                sel.add(new Option(data.ad, data.ad));
            });

            const modalSelect = document.getElementById("modal_beden_listesi");
            modalSelect.add(new Option(data.ad, data.id));

            document.getElementById("modal_beden_ad").value = "";
            bootstrap.Modal.getInstance(document.getElementById("bedenModal")).hide();
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}

function bedenPasifYap() {
    const bedenId = document.getElementById("modal_beden_listesi").value;
    if (!bedenId) { alert("LÃ¼tfen beden seÃ§in."); return; }

    if (!confirm("SeÃ§ili bedeni pasif yapmak istediÄŸinize emin misiniz?")) return;

    fetch("/ajax/beden/pasif-yap/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "id": bedenId })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("Beden pasif yapÄ±ldÄ±.");
            $("#modal_beden_listesi option[value='" + bedenId + "']").remove();
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}

/* ----------------- ÃœRÃœN KODU ----------------- */
function urunKodKaydet() {
    const kod = document.getElementById("modal_urun_kod").value.trim();
    if (!kod) { alert("ÃœrÃ¼n kodu boÅŸ olamaz!"); return; }

    fetch("/ajax/urun-kod/ekle/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "kod": kod })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            const select = document.getElementById("urun_kodu_select");
            const opt = new Option(data.kod, data.kod, true, true);
            select.add(opt);
            $("#urun_kodu_select").trigger("change");

            const modalSelect = document.getElementById("modal_urun_kod_listesi");
            modalSelect.add(new Option(data.kod, data.id));

            document.getElementById("modal_urun_kod").value = "";
            bootstrap.Modal.getInstance(document.getElementById("urunKodModal")).hide();
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}

function urunKodPasifYap() {
    const urunId = document.getElementById("modal_urun_kod_listesi").value;
    if (!urunId) { alert("LÃ¼tfen Ã¼rÃ¼n kodu seÃ§in."); return; }

    if (!confirm("SeÃ§ili Ã¼rÃ¼n kodunu pasif yapmak istediÄŸinize emin misiniz?")) return;

    fetch("/ajax/urun-kod/pasif-yap/", {
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        body: new URLSearchParams({ "id": urunId })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert("ÃœrÃ¼n kodu pasif yapÄ±ldÄ±.");
            $("#modal_urun_kod_listesi option[value='" + urunId + "']").remove();
        } else { alert(data.message || "Hata oluÅŸtu."); }
    });
}
</script>

</body>
</html>
