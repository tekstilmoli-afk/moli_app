<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>{% if edit_mode %}SipariÅŸi DÃ¼zenle{% else %}Yeni SipariÅŸ{% endif %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light py-5">

<div class="container">
    <div class="card shadow-lg mx-auto p-4" style="max-width: 700px;">
        <h2 class="mb-4 text-center">
            {% if edit_mode %}âœï¸ SipariÅŸi DÃ¼zenle{% else %}â• Yeni SipariÅŸ Ekle{% endif %}
        </h2>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- ğŸ§¾ TEMEL BÄ°LGÄ°LER -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="id_siparis_tipi" class="form-label">SipariÅŸ Tipi</label>
                    {{ form.siparis_tipi }}
                </div>

                <div class="col-md-6 mb-3" id="musteri_div">
                    <label for="id_musteri" class="form-label">MÃ¼ÅŸteri</label>
                    {{ form.musteri }}
                </div>


                <div class="col-md-6 mb-3">
    <label for="id_musteri_referans" class="form-label">MÃ¼ÅŸteri SipariÅŸ ReferansÄ±</label>
    {{ form.musteri_referans }}
</div>


                <div class="col-md-6 mb-3">
                    <label for="id_siparis_tarihi" class="form-label">SipariÅŸ Tarihi</label>
                    {{ form.siparis_tarihi }}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="id_teslim_tarihi" class="form-label">Teslim Tarihi</label>
                    {{ form.teslim_tarihi }}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="id_urun_kodu" class="form-label">ÃœrÃ¼n Kodu</label>
                    {{ form.urun_kodu }}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="id_adet" class="form-label">Adet</label>
                    {{ form.adet }}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="id_renk" class="form-label">Renk</label>
                    {{ form.renk }}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="id_beden" class="form-label">Beden</label>
                    {{ form.beden }}
                </div>

                <div class="col-12 mb-3">
                    <label for="id_aciklama" class="form-label">AÃ§Ä±klama</label>
                    {{ form.aciklama }}
                </div>

                <div class="col-12 mb-3">
                    <label for="id_resim" class="form-label">Resim</label>
                    {{ form.resim }}
                </div>
            </div>

            <!-- ğŸ’° FÄ°YAT & MALÄ°YET ALANLARI (YalnÄ±zca patron / mÃ¼dÃ¼r gÃ¶rÃ¼r) -->
{% if is_manager %}
<hr class="mt-4 mb-3">
<h5 class="text-primary">ğŸ’° Fiyat & Maliyet Bilgileri</h5>

<div class="row g-3">
    <!-- SatÄ±ÅŸ -->
    <div class="col-md-4">
        <label class="form-label fw-semibold">SatÄ±ÅŸ FiyatÄ±</label>
        {{ form.satis_fiyati }}
    </div>
    <div class="col-md-2">
        <label class="form-label fw-semibold">Para</label>
        {{ form.para_birimi }}
    </div>

    <!-- Maliyet -->
    <div class="col-md-4">
        <label class="form-label fw-semibold">Maliyet (Sistemdeki)</label>
        {{ form.maliyet_uygulanan }}
    </div>
    <div class="col-md-2">
        <label class="form-label fw-semibold">Para</label>
        {{ form.maliyet_para_birimi }}
    </div>

    <!-- Manuel Maliyet -->
    <div class="col-md-4">
        <label class="form-label fw-semibold">Manuel Maliyet</label>
        {{ form.maliyet_override }}
    </div>

    <!-- Ekstra -->
    <div class="col-md-4">
        <label class="form-label fw-semibold">Ekstra Maliyet</label>
        {{ form.ekstra_maliyet }}
    </div>

    

    <!-- Otomatik Kar AlanÄ± (Sadece gÃ¶rsel, hesaplama ÅŸimdilik backendâ€™de) -->
    <div class="col-12">
        <div class="alert alert-info py-2 mt-2">
            <strong>ğŸ’¹ Kar Bilgisi:</strong> Bu sipariÅŸin karÄ± sistem tarafÄ±ndan otomatik hesaplanacaktÄ±r.
        </div>
    </div>
</div>
{% endif %}


            <!-- ğŸ§­ Butonlar -->
            <div class="d-flex justify-content-between mt-4">
                {% if edit_mode %}
                    <a href="{% url 'order_detail' order.id %}" class="btn btn-secondary">âŒ VazgeÃ§</a>
                    <button type="submit" class="btn btn-warning">ğŸ’¾ GÃ¼ncelle</button>
                {% else %}
                    <a href="{% url 'order_list' %}" class="btn btn-secondary">â¬… Geri</a>
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Kaydet</button>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log("âœ… JS Ã§alÄ±ÅŸtÄ± - StoÄŸa Ãœretim kontrolÃ¼ baÅŸlatÄ±ldÄ±");

    const siparisTipiSelect = document.getElementById('id_siparis_tipi');
    const musteriDiv = document.getElementById('musteri_div');

    if (!siparisTipiSelect || !musteriDiv) {
        console.warn("âš ï¸ Elemanlar bulunamadÄ±:", siparisTipiSelect, musteriDiv);
        return;
    }

    function toggleMusteri() {
        console.log("ğŸŒ€ SeÃ§im deÄŸiÅŸti:", siparisTipiSelect.value);
        if (siparisTipiSelect.value === 'STOK') {
            musteriDiv.style.display = 'none';
            console.log("ğŸš« MÃ¼ÅŸteri alanÄ± gizlendi");
            const musteriInput = document.getElementById('id_musteri');
            if (musteriInput) musteriInput.value = '';
        } else {
            musteriDiv.style.display = 'block';
            console.log("ğŸ‘ï¸ MÃ¼ÅŸteri alanÄ± gÃ¶sterildi");
        }
    }

    siparisTipiSelect.addEventListener('change', toggleMusteri);
    toggleMusteri(); // sayfa aÃ§Ä±lÄ±ÅŸÄ±nda da kontrol et
});
</script>



</body>
</html>
