{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <h3 class="fw-bold">üè¨ {{ depo_adi }} Deposu</h3>
    <p class="text-muted">Toplam adet: <b>{{ toplam_adet }}</b></p>

    <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-bordered table-hover align-middle table-sm">
            <thead class="table-dark">
                <tr>
                    <th>√úr√ºn</th>
                    <th>Renk</th>
                    <th>Beden</th>
                    <th>Adet</th>
                    <th>Sipari≈ü No</th>
                    <th>QR</th>
                    <th>G√∂rsel</th>
                    <th>G√ºncelleme</th>
                    <th class="text-end">ƒ∞≈ülem</th>
                </tr>
            </thead>

            <tbody>
                {% for s in stoklar %}
                <tr>

                    <!-- √úr√ºn -->
                    <td class="fw-semibold">{{ s.urun_kodu }}</td>

                    <!-- Renk -->
                    <td>{{ s.renk }}</td>

                    <!-- Beden -->
                    <td>{{ s.beden }}</td>

                    <!-- Adet -->
                    <td><b>{{ s.adet }}</b></td>

                    <!-- Sipari≈ü Baƒülantƒ±sƒ± -->
                    <td>
                        {% if s.order_id %}
                            <a href="{% url 'order_detail' s.order_id %}" class="text-primary text-decoration-none fw-semibold">
                                {{ s.order__siparis_numarasi }}
                            </a>
                        {% else %}
                            <span class="text-muted">‚Äî</span>
                        {% endif %}
                    </td>

                    <!-- QR -->
                    <td>
                        {% if s.qr %}
                        <img src="{{ s.qr }}" style="width:45px; height:45px;" class="img-thumbnail"
                             data-bs-toggle="modal" data-bs-target="#qrModal{{ s.id }}">
                        {% else %}
                            <span class="text-muted small">Yok</span>
                        {% endif %}
                    </td>

                    <!-- √úr√ºn G√∂rseli -->
                    <td>
                        {% if s.image %}
                            <img src="{{ s.image }}" style="width:45px; height:45px; object-fit:cover;" class="rounded">
                        {% else %}
                            <span class="text-muted small">‚Äî</span>
                        {% endif %}
                    </td>

                    <!-- G√ºncelleme Tarihi -->
                    <td>
                        <small class="text-muted">{{ s.updated_at|date:"d.m.Y H:i" }}</small>
                    </td>

                    <!-- ƒ∞≈ülem -->
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-success"
                                data-bs-toggle="modal"
                                data-bs-target="#verModal{{ s.id }}">
                            üì¶ Hazƒ±rdan Ver
                        </button>
                    </td>

                </tr>

                <!-- QR Modal -->
                <div class="modal fade" id="qrModal{{ s.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content p-3 text-center">
                            <img src="{{ s.qr }}" class="img-fluid">
                            <p class="mt-2 fw-bold">{{ s.urun_kodu }} ‚Äî {{ s.renk }} ({{ s.beden }})</p>
                        </div>
                    </div>
                </div>

                <!-- Hazƒ±rdan Ver Modal -->
                <div class="modal fade" id="verModal{{ s.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form method="post" action="{% url 'hazirdan_ver' s.id %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                    <h5 class="modal-title">üì¶ {{ s.urun_kodu }} - {{ s.renk }} ({{ s.beden }})</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>

                                <div class="modal-body">
                                    <label class="form-label">Sipari≈ü Se√ß</label>
                                    <select name="order_id" class="form-select" required>
                                        <option value="">Sipari≈ü se√ßin...</option>
                                        {% for o in siparisler %}
                                            <option value="{{ o.id }}">
                                                {{ o.siparis_numarasi }} - {{ o.musteri }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒ∞ptal</button>
                                    <button type="submit" class="btn btn-success">Teslim Et</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

{% endblock %}
