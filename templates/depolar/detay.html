{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <h3 class="fw-bold">ğŸ¬ {{ depo_adi }} Deposu</h3>
    <p class="text-muted">Toplam adet: <b>{{ toplam_adet }}</b></p>

    <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-bordered table-hover align-middle table-sm">
            <thead class="table-dark">
                <tr>
                    <th>ÃœrÃ¼n</th>
                    <th>Renk</th>
                    <th>Beden</th>
                    <th>Adet</th>
                    <th>SipariÅŸ No</th>
                    <th>SipariÅŸ Tipi</th>
                    <th>MÃ¼ÅŸteri</th>
                    <th>SipariÅŸ Tarihi</th>
                    <th>Teslim Tarihi</th>
                    <th>GÃ¼ncelleme</th>
                    <th class="text-end">Ä°ÅŸlem</th>
                </tr>
            </thead>

            <tbody>
                {% for s in stoklar %}
                <tr>

                    <!-- ÃœrÃ¼n -->
                    <td class="fw-semibold">{{ s.urun_kodu }}</td>

                    <!-- Renk -->
                    <td>{{ s.renk }}</td>

                    <!-- Beden -->
                    <td>{{ s.beden }}</td>

                    <!-- Adet -->
                    <td><b>{{ s.adet }}</b></td>

                    <!-- SipariÅŸ No -->
                    <td>
                        {% if s.order_id %}
                            <a href="{% url 'order_detail' s.order_id %}"
                               class="text-primary text-decoration-none fw-semibold">
                                {{ s.order_siparis_no }}
                            </a>
                        {% else %}
                            <span class="text-muted">â€”</span>
                        {% endif %}
                    </td>

                    <!-- SipariÅŸ Tipi -->
                    <td>{{ s.order_tipi|default:"â€”" }}</td>

                    <!-- MÃ¼ÅŸteri -->
                    <td>{{ s.order_musteri|default:"â€”" }}</td>

                    <!-- SipariÅŸ Tarihi -->
                    <td>{{ s.order_siparis_tarihi|date:"d.m.Y"|default:"â€”" }}</td>

                    <!-- Teslim Tarihi -->
                    <td>{{ s.order_teslim_tarihi|date:"d.m.Y"|default:"â€”" }}</td>

                    <!-- GÃ¼ncelleme -->
                    <td>
                        <small class="text-muted">{{ s.updated_at|date:"d.m.Y H:i" }}</small>
                    </td>

                    <!-- Ä°ÅŸlem -->
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-success"
                                data-bs-toggle="modal"
                                data-bs-target="#verModal{{ s.id }}">
                            ğŸ“¦ HazÄ±rdan Ver
                        </button>
                    </td>

                </tr>

                <!-- HazÄ±rdan Ver Modal -->
                <div class="modal fade" id="verModal{{ s.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form method="post" action="{% url 'hazirdan_ver' s.id %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                    <h5 class="modal-title">ğŸ“¦ {{ s.urun_kodu }} - {{ s.renk }} ({{ s.beden }})</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>

                                <div class="modal-body">
                                    <label class="form-label">SipariÅŸ SeÃ§</label>
                                    <select name="order_id" class="form-select" required>
                                        <option value="">SipariÅŸ seÃ§in...</option>
                                        {% for o in siparisler %}
                                            <option value="{{ o.id }}">
                                                {{ o.siparis_numarasi }} - {{ o.musteri }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ä°ptal</button>
                                    <button type="submit" class="btn btn-success">Teslim Et</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

{% endblock %}
