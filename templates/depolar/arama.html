{% extends "base.html" %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- ğŸ”™ Geri DÃ¶n + BaÅŸlÄ±k -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <a href="{% url 'depo_ozet' %}" class="btn btn-outline-secondary btn-sm me-2">â† Geri DÃ¶n</a>
      <h3 class="fw-bold d-inline">ğŸ¬ Depolarda ÃœrÃ¼n Arama</h3>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#filterModal">ğŸ” Filtrele</button>
      <a href="{% url 'depo_arama' %}" class="btn btn-outline-secondary btn-sm">â™»ï¸ Temizle</a>
    </div>
  </div>

  <!-- ğŸ”¹ SonuÃ§ Tablosu -->
  {% if stoklar %}
  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle table-sm">
      <thead class="table-dark">
        <tr>
          <th>ğŸ·ï¸ Depo</th>
          <th>ğŸ“¦ ÃœrÃ¼n Kodu</th>
          <th>ğŸ¨ Renk</th>
          <th>ğŸ“ Beden</th>
          <th>ğŸ”¢ Toplam Adet</th>
          <th>ğŸ§¾ SipariÅŸ No</th>
        </tr>
      </thead>
      <tbody>
        {% for s in stoklar %}
        <tr>
          <td>
            <a href="{% url 'depo_detay' s.depo %}" class="fw-semibold text-decoration-none text-primary">
              {{ s.depo }}
            </a>
          </td>
          <td>{{ s.urun_kodu }}</td>
          <td>{{ s.renk }}</td>
          <td>{{ s.beden }}</td>
          <td><strong>{{ s.toplam_adet }}</strong></td>
          <td>
  {% if s.order__id %}
    <a href="{% url 'order_detail' s.order__id %}" class="fw-semibold text-primary text-decoration-none">
      {{ s.order__siparis_numarasi }}
    </a>
  {% else %}
    <span class="text-muted">â€”</span>
  {% endif %}
</td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% elif request.GET %}
  <p class="text-muted">SonuÃ§ bulunamadÄ±.</p>
  {% endif %}
  <!-- âœ… Burada endif eksikti, ÅŸimdi eklendi -->
</div>

<!-- ğŸ”½ Filtre Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ğŸ” Filtrele</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>

      <form method="get">
        <div class="modal-body">

          <!-- ÃœrÃ¼n Kodu -->
          <div class="mb-3">
            <label class="form-label">ÃœrÃ¼n Kodu</label>
            <select name="urun_kodu" class="selectpicker" data-live-search="true" data-width="100%">
              <option value="">TÃ¼mÃ¼</option>
              {% for u in urun_listesi %}
              <option value="{{ u }}" {% if request.GET.urun_kodu == u %}selected{% endif %}>{{ u }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Renk -->
          <div class="mb-3">
            <label class="form-label">Renk</label>
            <select name="renk" class="selectpicker" data-live-search="true" data-width="100%">
              <option value="">TÃ¼mÃ¼</option>
              {% for r in renk_listesi %}
              <option value="{{ r }}" {% if request.GET.renk == r %}selected{% endif %}>{{ r }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Beden -->
          <div class="mb-3">
            <label class="form-label">Beden</label>
            <select name="beden" class="selectpicker" data-live-search="true" data-width="100%">
              <option value="">TÃ¼mÃ¼</option>
              {% for b in beden_listesi %}
              <option value="{{ b }}" {% if request.GET.beden == b %}selected{% endif %}>{{ b }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Depo -->
          <div class="mb-3">
            <label class="form-label">Depo</label>
            <select name="depo" class="selectpicker" data-live-search="true" data-width="100%">
              <option value="">TÃ¼mÃ¼</option>
              {% for d in depo_listesi %}
              <option value="{{ d }}" {% if request.GET.depo == d %}selected{% endif %}>{{ d }}</option>
              {% endfor %}
            </select>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
          <button type="submit" class="btn btn-primary">Filtreyi Uygula</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
<script>
  $(function() {
    $('.selectpicker').selectpicker();
  });
</script>
{% endblock %}
