{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <a href="/management/" class="btn btn-outline-primary btn-sm mb-3">‚Üê Y√∂netim Paneline D√∂n</a>

    <h2 class="mb-4">üìä Genel √úretim Raporu</h2>

    <!-- üîç Filtre Alanƒ± -->
    <form method="get" class="row g-2 mb-4">
        <div class="col-md-3">
            <label class="form-label">Ba≈ülangƒ±√ß Tarihi</label>
            <input type="date" name="start" value="{{ start_date }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">Biti≈ü Tarihi</label>
            <input type="date" name="end" value="{{ end_date }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">G√∂rev Filtresi</label>
            <select name="gorev" class="form-select">
                <option value="">T√ºm√º</option>
                {% for val,label in GOREVLER %}
                    <option value="{{ val }}" {% if gorev_filter == val %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Filtrele</button>
        </div>
    </form>

    <!-- üì¶ √úretim A≈üama √ñzeti -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">√úretim A≈üamalarƒ± √ñzeti</div>
        <div class="card-body table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>A≈üama</th>
                        <th>Durum</th>
                        <th>Toplam</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in stage_summary %}
                        <tr>
                            <td>{{ row.stage|default:"-" }}</td>
                            <td>{{ row.value|default:"-" }}</td>
                            <td><strong>{{ row.count }}</strong></td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="3" class="text-center text-muted">Kayƒ±t bulunamadƒ±.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- üë• Kullanƒ±cƒ± Bazlƒ± √ñzet -->
    <div class="card">
        <div class="card-header bg-secondary text-white">Kullanƒ±cƒ± Aktivite √ñzeti</div>
        <div class="card-body table-responsive">
            <table class="table table-striped align-middle">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Kullanƒ±cƒ±</th>
                        <th>G√∂rev</th>
                        <th>Toplam ƒ∞≈ülem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in user_summary %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ row.user }}</td>
                            <td>{{ row.gorev|default:"-" }}</td>
                            <td><strong>{{ row.total }}</strong></td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="4" class="text-center text-muted">Hen√ºz i≈ülem yapƒ±lmamƒ±≈ü.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
